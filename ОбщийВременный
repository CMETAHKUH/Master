Функция ПоточноеСозданиеЗаявок(МассивДанных, КоличествоПотоков, Знач КоличествоДанныхВПотоке=0, СервисДляОтправкиДанных, ДожидатьсяЗавершения)Экспорт
	
	Результат = Истина;
	
	Если КоличествоДанныхВПотоке = 0 Тогда
		КоличествоДанныхВПотоке = Цел(МассивДанных.Количество()/КоличествоПотоков);
	КонецЕсли;
	
	МассивПараметров 	= Новый Массив;
	МассивСтрок 		= Новый Массив;
	
	i = 0;
	Для Каждого Стр из МассивДанных Цикл
		
		Если i >= КоличествоДанныхВПотоке Тогда
			i = 0;
			МассивСтрок = Новый Массив;
		КонецЕсли;
		
		МассивСтрок.Добавить(Стр);
		i = i+1;
		
		Если i = КоличествоДанныхВПотоке Тогда
			МассивПараметров.Добавить(МассивСтрок);
		КонецЕсли;
		
	КонецЦикла;
	
	Если МассивДанных.Количество() % КоличествоДанныхВПотоке <> 0 Тогда
		МассивПараметров.Добавить(МассивСтрок);
	КонецЕсли;
		
	УИДы = Новый Массив;
	
	Для каждого Элемент из МассивПараметров Цикл
		Параметры = Новый Массив;
		Параметры.Добавить(Элемент);
		Параметры.Добавить(СервисДляОтправкиДанных);
		УИД = ФоновыеЗадания.Выполнить("ОбщийВременный.ВызватьСозданиеЗаявок", Параметры);
		УИДы.Добавить(УИД);		
	КонецЦикла;
	
	Если УИДы.Количество() > 0 Тогда
		МассивЗаданий = ПроверкаВыполненияВсехЗаданийВМассиве(УИДы);
		Пока МассивЗаданий.Количество() > 0  Цикл
			МассивЗаданий = ПроверкаВыполненияВсехЗаданийВМассиве(МассивЗаданий);
		КонецЦикла;
	КонецЕсли; 
		
	Возврат Результат;
	
КонецФункции

Функция ПроверкаВыполненияВсехЗаданийВМассиве(МассивЗаданий)
	
	МассивЗаданий = ФоновыеЗадания.ОжидатьЗавершенияВыполнения(МассивЗаданий);
	Результат  = Новый Массив;
	
	Для каждого Стр из МассивЗаданий Цикл
		Если Стр.Состояние = СостояниеФоновогоЗадания.Активно Тогда
			Результат.Добавить(Стр);
		КонецЕсли;
	КонецЦикла;
	
	Возврат Результат;
	
КонецФункции

Функция ВызватьСозданиеЗаявок(МассивДанных, АдресВебСервера)Экспорт
	
	Сервис = ИнициализируюВебсервисСервер(АдресВебСервера);
	Для каждого Элемент из МассивДанных Цикл
		СозданиеЗаявки(Сервис, Элемент);
	КонецЦикла;
			
КонецФункции

Функция ИнициализируюВебсервисСервер(АдресВебСервера)
	
	Сервис = ПолучитьСервисСервер(АдресВебСервера);
	
	Если ТипЗнч(Сервис) = Тип("WSПрокси") Тогда
		
		Возврат Сервис;
		
	Иначе
		
		Возврат Неопределено;
		
	КонецЕсли;
	
КонецФункции 

Функция ПолучитьСервисСервер(Путь)
	
	Пользователь= СокрЛП("ws");
	Пароль = СокрЛП("ws");
	Определение = Новый WSОпределения(Путь, Пользователь, Пароль);
	WSСервис = Определение.Сервисы[0];
	Сервис = Новый WSПрокси(Определение, WSСервис.URIПространстваИмен, WSСервис.Имя, WSСервис.ТочкиПодключения[0].Имя);
	
	Сервис.Пользователь = Пользователь;
	Сервис.Пароль = Пароль;
	
	
	Возврат Сервис;
	
КонецФункции

Процедура СозданиеЗаявки(Сервис, ДанныеЗаявки)
	
	Сервис.LoanApplication(ДанныеЗаявки);
	
КонецПроцедуры
